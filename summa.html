<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Firebase Google Auth (REST API)</title>
</head>
<body>
  <h2>Firebase Google Sign-In (REST API Only)</h2>
  <button id="googleSignInBtn">Sign in with Google</button>
  <button id="signOutBtn">Sign Out</button>

  <h3>User Info:</h3>
  <pre id="userInfo">No user signed in</pre>

  <script>
    // =============================
    // 🔑 Firebase Project Settings
    // =============================
    const API_KEY = "AIzaSyAR10NJqR8wUDIimsxHMsW307P_vdbO_dE"; // your Firebase API key
    const GOOGLE_CLIENT_ID = "336616953225-lf8gemh128jsd4rmddjc3d2oc4g3bkog.apps.googleusercontent.com"; // replace with your Google OAuth client ID
    const REDIRECT_URI = "http://127.0.0.1:5500"; // e.g., http://127.0.0.1:5500

    // =============================
    // ⚙️ Helper Functions
    // =============================
    function updateUserInfo(user) {
      const userInfo = document.getElementById("userInfo");
      if (user) {
        userInfo.textContent = JSON.stringify(user, null, 2);
      } else {
        userInfo.textContent = "No user signed in";
      }
    }

    function showError(error) {
      const userInfo = document.getElementById("userInfo");
      userInfo.textContent = "Error: " + error;
      console.error(error);
    }

    // =============================
    // 🟢 Step 1: Sign in with Google
    // =============================
    document.getElementById("googleSignInBtn").addEventListener("click", () => {
      const googleAuthUrl = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${GOOGLE_CLIENT_ID}&redirect_uri=${REDIRECT_URI}&response_type=token&scope=email%20profile%20openid`;
      window.location.href = googleAuthUrl;
    });

    // =============================
    // 🟡 Step 2: Handle redirect
    // =============================
    window.addEventListener("load", async () => {
      const hash = window.location.hash;
      if (hash.includes("access_token")) {
        const params = new URLSearchParams(hash.substring(1));
        const accessToken = params.get("access_token");

        try {
          // Exchange Google token for Firebase ID token
          const response = await fetch(
            `https://identitytoolkit.googleapis.com/v1/accounts:signInWithIdp?key=${API_KEY}`,
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                postBody: `access_token=${accessToken}&providerId=google.com`,
                requestUri: REDIRECT_URI,
                returnSecureToken: true,
              }),
            }
          );

          const data = await response.json();

          if (data.error) throw new Error(data.error.message);

          const user = {
            name: data.displayName,
            email: data.email,
            photoURL: data.photoUrl,
            idToken: data.idToken,
          };

          // Save user session
          sessionStorage.setItem("firebaseUser", JSON.stringify(user));

          updateUserInfo(user);
          window.location.hash = ""; // clean up the URL
        } catch (err) {
          showError(err.message);
        }
      } else {
        // Already logged in?
        const user = JSON.parse(sessionStorage.getItem("firebaseUser"));
        updateUserInfo(user);
      }
    });

    // =============================
    // 🔴 Step 3: Sign Out
    // =============================
    document.getElementById("signOutBtn").addEventListener("click", () => {
      sessionStorage.removeItem("firebaseUser");
      updateUserInfo(null);
    });
  </script>
</body>
</html>
